apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: argocd-cluster
  namespace: argocd
  labels:
    app.kubernetes.io/name: argocd-cluster
    app.kubernetes.io/part-of: gke-bootstrap
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: gcp-secret-manager
    kind: SecretStore
  target:
    name: argocd-cluster
    creationPolicy: Owner
    template:
      metadata:
        labels:
          argocd.argoproj.io/secret-type: cluster
        annotations:
          # Custom metadata fields - accessible in ApplicationSet as {{index .metadata.annotations "key"}}
          meta_git_repo: "{{ .meta_git_repo }}"
          meta_git_revision: "{{ .meta_git_revision }}"
          meta_argocd_path: "{{ .meta_argocd_path }}"
          meta_cluster_name: "{{ .meta_cluster_name }}"
          meta_cluster_type: "{{ .meta_cluster_type }}"
          meta_cluster_endpoint: "{{ .meta_cluster_endpoint }}"
          meta_dns_endpoint: "{{ .meta_dns_endpoint }}"
          meta_environment: "{{ .meta_environment }}"
          meta_sector: "{{ .meta_sector }}"
          meta_infra_id: "{{ .meta_infra_id }}"
          meta_project_id: "{{ .meta_project_id }}"
          meta_region: "{{ .meta_region }}"
          meta_global_project_id: "{{ .meta_global_project_id }}"
          meta_hc_dns_domains: "{{ .meta_hc_dns_domains }}"
          meta_hc_dns_parent: "{{ .meta_hc_dns_parent }}"
          meta_workload_pool: "{{ .meta_workload_pool }}"
      data:
        # ArgoCD cluster secret required fields in data section
        name: "{{ .meta_cluster_name }}"
        server: "{{ .server }}"
        config: "{{ .config }}"
  dataFrom:
    - extract:
        key: argocd-cluster
