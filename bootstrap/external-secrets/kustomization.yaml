apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - namespace.yaml
  - controller.yaml

# Increase replicas for webhook components to meet GKE minimum availability
replicas:
  - name: external-secrets-cert-controller
    count: 2
  - name: external-secrets-webhook
    count: 2

# Tell Config Sync to not manage the webhook secret - cert-controller populates it with TLS certs
patches:
  - target:
      kind: Secret
      name: external-secrets-webhook
    patch: |
      - op: add
        path: /metadata/annotations/configsync.gke.io~1managed
        value: disabled
